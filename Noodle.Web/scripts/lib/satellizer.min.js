(function(n,t,i){"use strict";t.module("satellizer",[]).constant("SatellizerConfig",{httpInterceptor:!0,withCredentials:!0,tokenRoot:null,cordova:!1,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenPrefix:"satellizer",authHeader:"Authorization",authToken:"Bearer",storageType:"localStorage",providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.3/dialog/oauth",redirectUri:(n.location.origin||n.location.protocol+"//"+n.location.host)+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",authorizationEndpoint:"https://api.instagram.com/oauth/authorize"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,type:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,requiredUrlParams:["scope"],scope:["user_read"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:n.location.origin||n.location.protocol+"//"+n.location.host,scope:[],scopeDelimiter:",",type:"2.0",popupOptions:{width:559,height:519}}}}).provider("$auth",["SatellizerConfig",function(n){Object.defineProperties(this,{httpInterceptor:{get:function(){return n.httpInterceptor},set:function(t){n.httpInterceptor=t}},baseUrl:{get:function(){return n.baseUrl},set:function(t){n.baseUrl=t}},loginUrl:{get:function(){return n.loginUrl},set:function(t){n.loginUrl=t}},signupUrl:{get:function(){return n.signupUrl},set:function(t){n.signupUrl=t}},tokenRoot:{get:function(){return n.tokenRoot},set:function(t){n.tokenRoot=t}},tokenName:{get:function(){return n.tokenName},set:function(t){n.tokenName=t}},tokenPrefix:{get:function(){return n.tokenPrefix},set:function(t){n.tokenPrefix=t}},unlinkUrl:{get:function(){return n.unlinkUrl},set:function(t){n.unlinkUrl=t}},authHeader:{get:function(){return n.authHeader},set:function(t){n.authHeader=t}},authToken:{get:function(){return n.authToken},set:function(t){n.authToken=t}},withCredentials:{get:function(){return n.withCredentials},set:function(t){n.withCredentials=t}},cordova:{get:function(){return n.cordova},set:function(t){n.cordova=t}},storageType:{get:function(){return n.storageType},set:function(t){n.storageType=t}}});t.forEach(Object.keys(n.providers),function(i){this[i]=function(r){return t.extend(n.providers[i],r)}},this);var i=function(i){n.providers[i.name]=n.providers[i.name]||{};t.extend(n.providers[i.name],i)};this.oauth1=function(t){i(t);n.providers[t.name].type="1.0"};this.oauth2=function(t){i(t);n.providers[t.name].type="2.0"};this.$get=["$q","SatellizerShared","SatellizerLocal","SatellizerOauth",function(n,t,i,r){var u={};return u.login=function(n,t){return i.login(n,t)},u.signup=function(n,t){return i.signup(n,t)},u.logout=function(){return t.logout()},u.authenticate=function(n,t){return r.authenticate(n,t)},u.link=function(n,t){return r.authenticate(n,t)},u.unlink=function(n,t){return r.unlink(n,t)},u.isAuthenticated=function(){return t.isAuthenticated()},u.getToken=function(){return t.getToken()},u.setToken=function(n){t.setToken({access_token:n})},u.removeToken=function(){return t.removeToken()},u.getPayload=function(){return t.getPayload()},u.setStorageType=function(n){return t.setStorageType(n)},u}]}]).factory("SatellizerShared",["$q","$window","SatellizerConfig","SatellizerStorage",function(i,r,u,f){var e={},o=u.tokenPrefix?[u.tokenPrefix,u.tokenName].join("_"):u.tokenName;return e.getToken=function(){return f.get(o)},e.getPayload=function(){var t=f.get(o),i,r;if(t&&t.split(".").length===3)return i=t.split(".")[1],r=i.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(n.atob(r))))},e.setToken=function(n){var i=n&&n.access_token,r,e,s;if(i&&(t.isObject(i)&&t.isObject(i.data)?n=i:t.isString(i)&&(r=i)),!r&&n&&(e=u.tokenRoot&&u.tokenRoot.split(".").reduce(function(n,t){return n[t]},n.data),r=e?e[u.tokenName]:n.data[u.tokenName]),!r){s=u.tokenRoot?u.tokenRoot+"."+u.tokenName:u.tokenName;throw new Error('Expecting a token named "'+s+'" but instead got: '+JSON.stringify(n.data));}f.set(o,r)},e.removeToken=function(){f.remove(o)},e.isAuthenticated=function(){var n=f.get(o),i;if(n){if(n.split(".").length===3){var u=n.split(".")[1],e=u.replace(/-/g,"+").replace(/_/g,"/"),t=JSON.parse(r.atob(e)).exp;return t?(i=Math.round((new Date).getTime()/1e3)>=t,i?(f.remove(o),!1):!0):!0}return!0}return!1},e.logout=function(){return f.remove(o),i.when()},e.setStorageType=function(n){u.storageType=n},e}]).factory("SatellizerOauth",["$q","$http","SatellizerConfig","SatellizerUtils","SatellizerShared","SatellizerOauth1","SatellizerOauth2",function(n,t,i,r,u,f,e){var o={};return o.authenticate=function(t,r){var s=i.providers[t].type==="1.0"?new f:new e,o=n.defer();return s.open(i.providers[t],r||{}).then(function(n){u.setToken(n.data,!1);o.resolve(n.data)}).catch(function(n){o.reject(n)}),o.promise},o.unlink=function(n,u){return u=u||{},u.url=i.baseUrl?r.joinUrl(i.baseUrl,i.unlinkUrl):i.unlinkUrl,u.data={provider:n}||u.data,u.method=u.method||"POST",t(u)},o}]).factory("SatellizerLocal",["$http","SatellizerUtils","SatellizerShared","SatellizerConfig",function(n,t,i,r){var u={};return u.login=function(u,f){return f=f||{},f.url=r.baseUrl?t.joinUrl(r.baseUrl,r.loginUrl):r.loginUrl,f.data=u||f.data,f.method=f.method||"POST",n(f).then(function(n){return i.setToken(n),n})},u.signup=function(i,u){return u=u||{},u.url=r.baseUrl?t.joinUrl(r.baseUrl,r.signupUrl):r.signupUrl,u.data=i||u.data,u.method=u.method||"POST",n(u)},u}]).factory("SatellizerOauth2",["$q","$http","$window","SatellizerPopup","SatellizerUtils","SatellizerConfig","SatellizerStorage",function(n,i,r,u,f,e,o){return function(){var s={},r={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}};return s.open=function(i,h){r=f.merge(i,r);var c,a,l=r.name+"_state";return t.isFunction(r.state)?o.set(l,r.state()):t.isString(r.state)&&o.set(l,r.state),c=[r.authorizationEndpoint,s.buildQueryString()].join("?"),a=e.cordova?u.open(c,r.name,r.popupOptions,r.redirectUri).eventListener(r.redirectUri):u.open(c,r.name,r.popupOptions,r.redirectUri).pollPopup(),a.then(function(t){return r.responseType==="token"?t:t.state&&t.state!==o.get(l)?n.reject('OAuth "state" mismatch'):s.exchangeForToken(t,h)})},s.exchangeForToken=function(n,u){var o=t.extend({},u),s;return t.forEach(r.responseParams,function(t,i){switch(i){case"code":o[t]=n.code;break;case"clientId":o[t]=r.clientId;break;case"redirectUri":o[t]=r.redirectUri;break;default:o[t]=n[i]}}),n.state&&(o.state=n.state),s=e.baseUrl?f.joinUrl(e.baseUrl,r.url):r.url,i.post(s,o,{withCredentials:e.withCredentials})},s.buildQueryString=function(){var n=[];return t.forEach(["defaultUrlParams","requiredUrlParams","optionalUrlParams"],function(i){t.forEach(r[i],function(i){var s=f.camelCase(i),u=t.isFunction(r[i])?r[i]():r[s],e;i==="state"&&(e=r.name+"_state",u=encodeURIComponent(o.get(e)));i==="scope"&&Array.isArray(u)&&(u=u.join(r.scopeDelimiter),r.scopePrefix&&(u=[r.scopePrefix,u].join(r.scopeDelimiter)));n.push([i,u])})}),n.map(function(n){return n.join("=")}).join("&")},s}}]).factory("SatellizerOauth1",["$q","$http","SatellizerPopup","SatellizerConfig","SatellizerUtils",function(n,i,r,u,f){return function(){var e={},n={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return e.open=function(o,s){t.extend(n,o);var h,c=u.baseUrl?f.joinUrl(u.baseUrl,n.url):n.url;return u.cordova||(h=r.open("",n.name,n.popupOptions,n.redirectUri)),i.post(c,n).then(function(t){u.cordova?h=r.open([n.authorizationEndpoint,e.buildQueryString(t.data)].join("?"),n.name,n.popupOptions,n.redirectUri):h.popupWindow.location=[n.authorizationEndpoint,e.buildQueryString(t.data)].join("?");var i=u.cordova?h.eventListener(n.redirectUri):h.pollPopup();return i.then(function(n){return e.exchangeForToken(n,s)})})},e.exchangeForToken=function(r,e){var o=t.extend({},e,r),s=u.baseUrl?f.joinUrl(u.baseUrl,n.url):n.url;return i.post(s,o,{withCredentials:u.withCredentials})},e.buildQueryString=function(n){var i=[];return t.forEach(n,function(n,t){i.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}),i.join("&")},e}}]).factory("SatellizerPopup",["$q","$interval","$window","SatellizerConfig","SatellizerUtils",function(r,u,f,e,o){var s={};return s.url="",s.popupWindow=null,s.open=function(t,i,r){s.url=t;var u=s.stringifyOptions(s.prepareOptions(r)),f=e.cordova?"_blank":i;return s.popupWindow=n.open(t,f,u),n.popup=s.popupWindow,s.popupWindow&&s.popupWindow.focus&&s.popupWindow.focus(),s},s.eventListener=function(n){var i=r.defer();return s.popupWindow.addEventListener("loadstart",function(r){var u;if(r.url.indexOf(n)===0&&(u=document.createElement("a"),u.href=r.url,u.search||u.hash)){var e=u.search.substring(1).replace(/\/$/,""),h=u.hash.substring(1).replace(/\/$/,""),c=o.parseQueryString(h),f=o.parseQueryString(e);t.extend(f,c);f.error||i.resolve(f);s.popupWindow.close()}}),s.popupWindow.addEventListener("loaderror",function(){i.reject("Authorization Failed")}),i.promise},s.pollPopup=function(){var n=r.defer(),f=u(function(){var e,h;try{if(e=document.location.host,h=s.popupWindow.location.host,h===e&&(s.popupWindow.location.search||s.popupWindow.location.hash)){var c=s.popupWindow.location.search.substring(1).replace(/\/$/,""),l=s.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),a=o.parseQueryString(l),r=o.parseQueryString(c);t.extend(r,a);r.error||n.resolve(r);s.popupWindow.close();u.cancel(f)}}catch(v){}(!s.popupWindow||s.popupWindow.closed||s.popupWindow.closed===i)&&u.cancel(f)},50);return n.promise},s.prepareOptions=function(n){n=n||{};var i=n.width||500,r=n.height||500;return t.extend({width:i,height:r,left:f.screenX+(f.outerWidth-i)/2,top:f.screenY+(f.outerHeight-r)/2.5},n)},s.stringifyOptions=function(n){var i=[];return t.forEach(n,function(n,t){i.push(t+"="+n)}),i.join(",")},s}]).service("SatellizerUtils",function(){this.camelCase=function(n){return n.replace(/([\:\-\_]+(.))/g,function(n,t,i,r){return r?i.toUpperCase():i})};this.parseQueryString=function(n){var r={},u,i;return t.forEach((n||"").split("&"),function(n){n&&(i=n.split("="),u=decodeURIComponent(i[0]),r[u]=t.isDefined(i[1])?decodeURIComponent(i[1]):!0)}),r};this.joinUrl=function(n,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var i=[n,t].join("/"),r=function(n){return n.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return r(i)};this.merge=function(n,t){var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=i in t&&typeof n[i]=="object"&&i!==null?this.merge(n[i],t[i]):n[i]);for(i in t)if(t.hasOwnProperty(i)){if(i in r)continue;r[i]=t[i]}return r}}).factory("SatellizerStorage",["$window","SatellizerConfig",function(n,t){var r=function(){var i,r;try{return i=t.storageType in n&&n[t.storageType]!==null,i&&(r=Math.random().toString(36).substring(7),n[t.storageType].setItem(r,""),n[t.storageType].removeItem(r)),i}catch(u){return!1}}();return r||console.warn("Satellizer Warning: "+t.storageType+" is not available."),{get:function(u){return r?n[t.storageType].getItem(u):i},set:function(u,f){return r?n[t.storageType].setItem(u,f):i},remove:function(u){return r?n[t.storageType].removeItem(u):i}}}]).factory("SatellizerInterceptor",["$q","SatellizerConfig","SatellizerStorage","SatellizerShared",function(n,t,i,r){return{request:function(n){if(n.skipAuthorization)return n;if(r.isAuthenticated()&&t.httpInterceptor){var f=t.tokenPrefix?t.tokenPrefix+"_"+t.tokenName:t.tokenName,u=i.get(f);t.authHeader&&t.authToken&&(u=t.authToken+" "+u);n.headers[t.authHeader]=u}return n},responseError:function(t){return n.reject(t)}}}]).config(["$httpProvider",function(n){n.interceptors.push("SatellizerInterceptor")}])})(window,window.angular);
//# sourceMappingURL=satellizer.min.js.map
